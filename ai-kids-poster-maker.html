<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI í‚¤ì¦ˆ í¬ìŠ¤í„° ë©”ì´ì»¤</title>
    <!-- Tailwind CSS ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ì•„ì´ë“¤ì´ ì¢‹ì•„í•  ë§Œí•œ ë¶€ë“œëŸ¬ìš´ ê¸€ê¼´ */
        @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap');
        body {
            font-family: 'Nanum Gothic', sans-serif;
        }
        /* ë²„íŠ¼ í´ë¦­ ì‹œ ì‘ì€ ì• ë‹ˆë©”ì´ì…˜ */
        .suggestion-btn:active {
            transform: scale(0.95);
            transition: transform 0.1s ease;
        }
    </style>
</head>
<body class="bg-blue-50 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white p-6 md:p-8 rounded-2xl shadow-xl w-full max-w-2xl">
        
        <header class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-blue-600">ğŸ¨ AI í¬ìŠ¤í„° ê·¸ë¦¬ê¸° ğŸ¨</h1>
            <p class="text-gray-600 mt-2">ë§Œë“¤ê³  ì‹¶ì€ í¬ìŠ¤í„°ë¥¼ ììœ ë¡­ê²Œ ìƒìƒí•´ ë³´ì„¸ìš”!</p>
        </header>

        <!-- í”„ë¡¬í”„íŠ¸ ì œì•ˆ ì„¹ì…˜ -->
        <div class="mb-4">
            <p class="font-bold text-lg text-gray-700 mb-3">ê·¸ë¦¼ íŒíŠ¸! (í´ë¦­í•´ì„œ ì¶”ê°€í•´ìš”)</p>
            <div id="suggestions-container" class="space-y-3">
                <!-- ì œì•ˆ ì¹´í…Œê³ ë¦¬ (ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ìƒì„±) -->
            </div>
        </div>

        <!-- í”„ë¡¬í”„íŠ¸ ì…ë ¥ ë° ì œì–´ -->
        <div class="mb-4">
            <label for="prompt-input" class="block font-bold text-lg text-gray-700 mb-2">ë‚˜ì˜ ìƒìƒ (ì—¬ê¸°ì— ì…ë ¥í•´ìš”)</label>
            <textarea id="prompt-input" rows="3" class="w-full p-3 border-2 border-blue-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="ì˜ˆ: í•˜ëŠ˜ì„ ë‚˜ëŠ” ê³ ë˜, ë¬´ì§€ê°œ ìˆ²"></textarea>
            <button id="clear-btn" class="text-sm text-gray-500 hover:text-red-500 mt-2">ë‹¤ì‹œ ì“°ê¸°</button>
        </div>

        <!-- ìƒì„± ë²„íŠ¼ -->
        <button id="generate-btn" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg text-lg shadow-md transition duration-300 transform hover:scale-105">
            í¬ìŠ¤í„° ë§Œë“¤ê¸°! âœ¨
        </button>

        <!-- ë¡œë”© ë° ê²°ê³¼ í‘œì‹œ -->
        <div id="result-container" class="mt-6 text-center">
            <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ -->
            <div id="loading" class="hidden flex-col items-center justify-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-4 border-blue-500"></div>
                <p class="text-blue-600 mt-4">ë©‹ì§„ í¬ìŠ¤í„°ë¥¼ ê·¸ë¦¬ê³  ìˆì–´ìš”... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”!</p>
            </div>
            
            <!-- ì˜¤ë¥˜ ë©”ì‹œì§€ -->
            <div id="error-message" class="hidden text-red-500 p-3 bg-red-100 rounded-lg">
                <!-- ì˜¤ë¥˜ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>

            <!-- ìƒì„±ëœ ì´ë¯¸ì§€ -->
            <div id="image-wrapper" class->
                <img id="poster-image" src="" alt="ìƒì„±ëœ í¬ìŠ¤í„°" class="hidden rounded-lg shadow-md max-w-full h-auto mx-auto">
            </div>
        </div>

    </div>

    <script>
        // --- ìš”ì†Œ ì„ íƒ ---
        const promptInput = document.getElementById('prompt-input');
        const generateBtn = document.getElementById('generate-btn');
        const clearBtn = document.getElementById('clear-btn');
        const loadingEl = document.getElementById('loading');
        const errorEl = document.getElementById('error-message');
        const posterImage = document.getElementById('poster-image');
        const imageWrapper = document.getElementById('image-wrapper');
        const suggestionsContainer = document.getElementById('suggestions-container');

        // --- í”„ë¡¬í”„íŠ¸ ì œì•ˆ ë°ì´í„° ---
        const suggestions = {
            "ëˆ„ê°€? ğŸ¦–": {
                color: "bg-green-100 text-green-800",
                items: ["ìš°ì£¼ë¹„í–‰ì‚¬ ê°•ì•„ì§€", "ë…¸ë˜í•˜ëŠ” ê³µë£¡", "ë¬´ì§€ê°œ ê³ ì–‘ì´", "ìŠˆí¼íˆì–´ë¡œ í† ë¼", "ì¶¤ì¶”ëŠ” ë¡œë´‡", "ë§ˆë²•ì‚¬ ê³°"]
            },
            "ì–´ë””ì„œ? ğŸŒ³": {
                color: "bg-yellow-100 text-yellow-800",
                items: ["ë‹¬ ìœ„ì—ì„œ", "ë§ˆë²•ì˜ ìˆ²ì—ì„œ", "êµ¬ë¦„ìœ¼ë¡œ ë§Œë“  ì„±", "ë°”ë‹¤ ì† íŒŒí‹°", "ì‚¬íƒ• ë‚˜ë¼", "ì¥ë‚œê° ë„ì‹œ"]
            },
            "ë¬´ì—‡ì„? ğŸ¦": {
                color: "bg-pink-100 text-pink-800",
                items: ["ì í”„í•˜ë©°", "ì•„ì´ìŠ¤í¬ë¦¼ì„ ë¨¹ìœ¼ë©°", "ì±…ì„ ì½ìœ¼ë©°", "ì¹œêµ¬ë“¤ê³¼ ë†€ë©°", "ìì „ê±°ë¥¼ íƒ€ë©°", "ë³„ì„ ì¡ìœ¼ë©°"]
            },
            "ì–´ë–»ê²Œ? ğŸ¨": {
                color: "bg-purple-100 text-purple-800",
                items: ["ë§Œí™” ìŠ¤íƒ€ì¼ë¡œ", "ìƒ‰ì—°í•„ë¡œ ê·¸ë¦° ê²ƒì²˜ëŸ¼", "ë°˜ì§ë°˜ì§ ë¹›ë‚˜ê²Œ", "ì•Œë¡ë‹¬ë¡í•˜ê²Œ", "ê¿ˆê¾¸ëŠ” ê²ƒì²˜ëŸ¼", "ì•„ì£¼ ë‹¨ìˆœí•˜ê²Œ"]
            }
        };

        // --- í”„ë¡¬í”„íŠ¸ ì œì•ˆ UI ìƒì„± ---
        function createSuggestionButtons() {
            Object.entries(suggestions).forEach(([category, data]) => {
                const categoryDiv = document.createElement('div');
                
                const title = document.createElement('span');
                title.textContent = category;
                title.className = "font-bold mr-2 text-sm";
                categoryDiv.appendChild(title);

                const buttonWrapper = document.createElement('div');
                buttonWrapper.className = "flex flex-wrap gap-2 mt-1";

                data.items.forEach(item => {
                    const button = document.createElement('button');
                    button.textContent = item;
                    button.className = `suggestion-btn ${data.color} px-3 py-1 rounded-full text-sm font-medium transition duration-200 hover:opacity-80`;
                    button.dataset.text = item; // ë°ì´í„°ë¥¼ ë²„íŠ¼ì— ì €ì¥
                    button.addEventListener('click', () => {
                        // í”„ë¡¬í”„íŠ¸ì— í…ìŠ¤íŠ¸ ì¶”ê°€ (ì•ë’¤ë¡œ ê³µë°± ì¶”ê°€)
                        promptInput.value += ` ${item} `;
                    });
                    buttonWrapper.appendChild(button);
                });

                categoryDiv.appendChild(buttonWrapper);
                suggestionsContainer.appendChild(categoryDiv);
            });
        }
        
        createSuggestionButtons(); // í˜ì´ì§€ ë¡œë“œ ì‹œ ë²„íŠ¼ ìƒì„±

        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        clearBtn.addEventListener('click', () => {
            promptInput.value = '';
            posterImage.classList.add('hidden');
            errorEl.classList.add('hidden');
        });

        generateBtn.addEventListener('click', generatePoster);

        // --- API í˜¸ì¶œ (ì§€ìˆ˜ ë°±ì˜¤í”„ í¬í•¨) ---
        async function fetchWithBackoff(url, options, retries = 3, delay = 1000) {
            try {
                const response = await fetch(url, options);
                if (!response.ok) {
                    if (retries > 0) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return fetchWithBackoff(url, options, retries - 1, delay * 2);
                    }
                    throw new Error(`HTTP ì˜¤ë¥˜! ìƒíƒœ: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                if (retries > 0) {
                    await new Promise(resolve => setTimeout(resolve, delay));
                    return fetchWithBackoff(url, options, retries - 1, delay * 2);
                }
                throw error;
            }
        }

        // --- í¬ìŠ¤í„° ìƒì„± í•¨ìˆ˜ ---
        async function generatePoster() {
            const userPrompt = promptInput.value.trim();

            if (!userPrompt) {
                showError("ë§Œë“¤ê³  ì‹¶ì€ í¬ìŠ¤í„°ì— ëŒ€í•´ ë¨¼ì € ì•Œë ¤ì£¼ì„¸ìš”!");
                return;
            }

            // UI ìƒíƒœ ì—…ë°ì´íŠ¸: ë¡œë”© ì‹œì‘
            loadingEl.classList.remove('hidden');
            errorEl.classList.add('hidden');
            posterImage.classList.add('hidden');
            generateBtn.disabled = true;
            generateBtn.textContent = "ê·¸ë¦¬ëŠ” ì¤‘...";

            // AIì—ê²Œ ë” ì¢‹ì€ í¬ìŠ¤í„°ë¥¼ ë§Œë“¤ë„ë¡ í”„ë¡¬í”„íŠ¸ë¥¼ ë‹¤ë“¬ìŠµë‹ˆë‹¤.
            const fullPrompt = `ì•„ì´ë“¤ì„ ìœ„í•œ í¬ìŠ¤í„°: ${userPrompt}. ë°ê³  ì•Œë¡ë‹¬ë¡í•œ ìƒ‰ê°, ë‹¨ìˆœí•œ ëª¨ì–‘, ì¬ë¯¸ìˆê³  ì¥ë‚œìŠ¤ëŸ¬ìš´ ìŠ¤íƒ€ì¼, ê¸€ì ì—†ìŒ`;

            // ë‚˜ë…¸ë°”ë‚˜ë‚˜ (gemini-2.5-flash-image-preview) API ì‚¬ìš©
            const apiKey = ""; // API í‚¤ëŠ” Canvas í™˜ê²½ì—ì„œ ìë™ìœ¼ë¡œ ì œê³µë©ë‹ˆë‹¤.
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{
                    parts: [{ text: fullPrompt }]
                }],
                generationConfig: {
                    responseModalities: ['TEXT', 'IMAGE']
                },
            };

            try {
                const result = await fetchWithBackoff(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                if (base64Data) {
                    // ì„±ê³µ: ì´ë¯¸ì§€ í‘œì‹œ
                    posterImage.src = `data:image/png;base64,${base64Data}`;
                    posterImage.classList.remove('hidden');
                } else {
                    // ì˜¤ë¥˜: ì‘ë‹µì— ì´ë¯¸ì§€ê°€ ì—†ìŒ
                    console.error("API ì‘ë‹µì— ì´ë¯¸ì§€ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤:", result);
                    showError("ì´ëŸ°! ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆì–´ìš”. í”„ë¡¬í”„íŠ¸ë¥¼ ì¡°ê¸ˆ ë°”ê¿”ì„œ ë‹¤ì‹œ ì‹œë„í•´ ë³¼ê¹Œìš”?");
                }

            } catch (error) {
                // ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” API ì˜¤ë¥˜
                console.error("API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                showError("í¬ìŠ¤í„°ë¥¼ ê·¸ë¦¬ë‹¤ê°€ ë¬¸ì œê°€ ìƒê²¼ì–´ìš”. ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
            } finally {
                // UI ìƒíƒœ ì—…ë°ì´íŠ¸: ë¡œë”© ì¢…ë£Œ
                loadingEl.classList.add('hidden');
                generateBtn.disabled = false;
                generateBtn.textContent = "í¬ìŠ¤í„° ë§Œë“¤ê¸°! âœ¨";
            }
        }

        // --- ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜ ---
        function showError(message) {
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
            loadingEl.classList.add('hidden');
        }

    </script>
</body>
</html>